# Architecture Decision Records (ADR)

## ADR-001: 単一ファイル構成の採用

**日付**: 2026-02-11

**ステータス**: 採用

**コンテキスト**:
シンプルなデータ分析スクリプトであり、複雑なモジュール分割は不要。利用者が単一ファイルで動作を理解しやすくする必要がある。

**決定**:
`analyze.py` 単一ファイルで全機能を実装する。

**理由**:
- コードベースが小規模（予想300-500行程度）
- 外部からの再利用を想定していない
- デプロイが容易（1ファイルコピーで完結）
- 学習・カスタマイズが容易

**代替案**:
- モジュール分割（`loader.py`, `analyzer.py`, `reporter.py` など）
  - 却下理由: 現時点では過剰設計

**影響**:
- コードが長くなった場合、関数単位で分離し可読性を維持する必要がある
- 将来的に複雑化する場合はリファクタリングが必要

---

## ADR-002: matplotlib vs plotly

**日付**: 2026-02-11

**ステータス**: 採用（matplotlib）

**コンテキスト**:
グラフ生成ライブラリの選択。静的HTMLレポートに埋め込む形式。

**決定**:
matplotlibを使用する。

**理由**:
- 軽量（依存ライブラリが少ない）
- Base64エンコードして埋め込みが容易
- 静的な画像生成に最適
- Python標準的なライブラリで習熟度が高い

**代替案**:
- plotly
  - メリット: インタラクティブなグラフ
  - 却下理由: 依存が重く、静的レポートには過剰

**影響**:
- グラフはインタラクティブではない（静的画像）
- シンプルなレポート生成で十分

---

## ADR-003: pyproject.toml + uv による依存管理

**日付**: 2026-02-11

**ステータス**: 採用

**コンテキスト**:
モダンなPythonプロジェクトの依存管理方法。uvによる高速なパッケージ管理。

**決定**:
`pyproject.toml` を使用し、`[project.dependencies]` に実行時依存を記載、`[project.optional-dependencies.dev]` に開発ツールを記載する。

**理由**:
- PEP 621準拠の標準的な方法
- `requirements.txt` よりも豊富なメタデータ管理が可能
- uvとの統合が良好
- 開発依存と実行依存の分離が明確

**代替案**:
- `requirements.txt` + `requirements-dev.txt`
  - 却下理由: モダンなプロジェクトでは pyproject.toml が標準

**影響**:
- プロジェクトのセットアップには `uv sync` を使用
- 開発環境の統一が容易

---

## ADR-004: HTMLテンプレート方式

**日付**: 2026-02-11

**ステータス**: 採用（f-string埋め込み）

**コンテキスト**:
HTMLレポート生成方法の選択。

**決定**:
シンプルなHTMLテンプレートをf-stringで生成する。

**理由**:
- テンプレートエンジン（Jinja2）の追加依存を避ける
- レポート構造がシンプルで、f-stringで十分
- コード内で完結し、外部ファイル不要

**代替案**:
- Jinja2テンプレートエンジン
  - 却下理由: 小規模レポートには過剰
- 専用のレポートライブラリ（pandas-profiling等）
  - 却下理由: カスタマイズ性が低く、依存が重い

**影響**:
- テンプレートが複雑になった場合、Jinja2への移行を検討

---

## ADR-005: エラーハンドリング戦略

**日付**: 2026-02-11

**ステータス**: 採用

**コンテキスト**:
ユーザーフレンドリーなエラーメッセージの提供。

**決定**:
以下の方針でエラーハンドリングを実装：
1. ファイルI/Oエラーは明確なメッセージを表示して終了
2. データ不正（カラム不足、型エラー）は詳細を表示
3. 欠損値は警告して除外処理
4. すべてのエラーは sys.exit(1) で終了

**理由**:
- CLIツールとして標準的な動作
- ユーザーが問題を特定しやすい
- 処理継続不可能な場合は明確に停止

**影響**:
- 各処理層で適切な例外ハンドリングを実装
- ログ出力をコンソールに統一
