# タスク分解

## フェーズ1: プロジェクトセットアップ

### タスク 1.1: プロジェクト構造の作成
- [ ] ディレクトリ構造の作成
  - `src/csv_analyzer/`
  - `src/csv_analyzer/services/`
  - `src/csv_analyzer/templates/`
  - `tests/`
  - `data/`
- [ ] 空の `__init__.py` ファイルの配置
- [ ] `.gitignore` ファイルの作成

**担当**: 開発者  
**所要時間**: 10分  
**依存**: なし

---

### タスク 1.2: pyproject.toml の作成
- [ ] プロジェクトメタデータの定義
- [ ] 実行時依存関係の定義
  - pandas
  - matplotlib
  - jinja2
- [ ] 開発用依存関係の定義
  - pytest
  - ruff
  - mypy
- [ ] ツール設定（ruff, pytest, mypy）
- [ ] ビルドシステムの設定

**担当**: 開発者  
**所要時間**: 15分  
**依存**: タスク 1.1

---

### タスク 1.3: README.md の作成
- [ ] プロジェクト概要
- [ ] インストール手順（uv使用）
- [ ] 使用方法
- [ ] 開発環境セットアップ
- [ ] テスト実行方法

**担当**: 開発者  
**所要時間**: 20分  
**依存**: タスク 1.2

---

## フェーズ2: データモデルの実装

### タスク 2.1: models.py の実装
- [ ] `DataRecord` dataclass の定義
- [ ] `Statistics` dataclass の定義
  - `to_dict()` メソッド
  - `__str__()` メソッド
- [ ] `PlotData` dataclass の定義
  - `from_figures()` クラスメソッド
- [ ] `AnalysisResult` dataclass の定義
  - `to_report_context()` メソッド
- [ ] 型ヒントの追加
- [ ] docstrings の追加

**担当**: 開発者  
**所要時間**: 30分  
**依存**: タスク 1.2

---

### タスク 2.2: models のテスト作成
- [ ] `tests/test_models.py` の作成
- [ ] 各dataclassの基本動作テスト
- [ ] バリデーションテスト
- [ ] メソッドの動作テスト

**担当**: 開発者  
**所要時間**: 30分  
**依存**: タスク 2.1

---

## フェーズ3: サービスレイヤーの実装

### タスク 3.1: data_loader.py の実装
- [ ] `load_csv()` 関数の実装
  - pandas での CSV 読み込み
  - エラーハンドリング
- [ ] `validate_data()` 関数の実装
  - カラム存在チェック
  - データ型チェック
  - 値の妥当性チェック
- [ ] 型ヒントと docstrings

**担当**: 開発者  
**所要時間**: 45分  
**依存**: タスク 2.1

---

### タスク 3.2: data_loader のテスト作成
- [ ] `tests/test_data_loader.py` の作成
- [ ] 正常系テスト
  - 有効なCSVファイルの読み込み
- [ ] 異常系テスト
  - ファイルが存在しない
  - カラムが不足
  - データ型が不正
  - NaN/Inf 値の検出
- [ ] テストデータの準備（fixture）

**担当**: 開発者  
**所要時間**: 45分  
**依存**: タスク 3.1

---

### タスク 3.3: statistics.py の実装
- [ ] `calculate_statistics()` 関数の実装
  - 平均、中央値、標準偏差の計算
  - 最小値、最大値の計算
  - データ件数の取得
  - Statistics オブジェクトの生成
- [ ] エラーハンドリング
- [ ] 型ヒントと docstrings

**担当**: 開発者  
**所要時間**: 30分  
**依存**: タスク 2.1

---

### タスク 3.4: statistics のテスト作成
- [ ] `tests/test_statistics.py` の作成
- [ ] 統計計算の正確性テスト
- [ ] エッジケースのテスト（データ1件など）
- [ ] テストデータの準備

**担当**: 開発者  
**所要時間**: 30分  
**依存**: タスク 3.3

---

### タスク 3.5: visualizer.py の実装
- [ ] `create_timeseries_plot()` 関数の実装
  - 日付 vs 値の折れ線グラフ
  - 軸ラベル、タイトルの設定
  - スタイリング
- [ ] `create_histogram()` 関数の実装
  - 値の分布ヒストグラム
  - 軸ラベル、タイトルの設定
  - スタイリング
- [ ] グラフの最適化（サイズ、DPI）
- [ ] 型ヒントと docstrings

**担当**: 開発者  
**所要時間**: 45分  
**依存**: タスク 2.1

---

### タスク 3.6: visualizer のテスト作成
- [ ] `tests/test_visualizer.py` の作成
- [ ] グラフ生成の動作確認
- [ ] Figure オブジェクトの検証
- [ ] エラーハンドリングのテスト

**担当**: 開発者  
**所要時間**: 30分  
**依存**: タスク 3.5

---

### タスク 3.7: reporter.py の実装
- [ ] HTMLテンプレートの作成
  - `templates/report.html`
  - CSS スタイリング
  - グラフ表示エリア
  - 統計情報テーブル
- [ ] `generate_html_report()` 関数の実装
  - Jinja2 テンプレートエンジンの初期化
  - コンテキストの準備
  - HTMLレンダリング
  - ファイル出力
- [ ] `print_summary()` 関数の実装
  - コンソール出力フォーマット
- [ ] 型ヒントと docstrings

**担当**: 開発者  
**所要時間**: 60分  
**依存**: タスク 2.1

---

### タスク 3.8: reporter のテスト作成
- [ ] `tests/test_reporter.py` の作成
- [ ] HTML生成の動作確認
- [ ] テンプレートレンダリングのテスト
- [ ] ファイル出力の検証
- [ ] コンソール出力のテスト

**担当**: 開発者  
**所要時間**: 30分  
**依存**: タスク 3.7

---

## フェーズ4: アプリケーションレイヤーの実装

### タスク 4.1: analyzer.py の実装
- [ ] `analyze_csv()` 関数の実装
  - データ読み込み
  - バリデーション
  - 統計計算
  - グラフ生成
  - AnalysisResult の構築
- [ ] エラーハンドリング
- [ ] ログ出力
- [ ] 型ヒントと docstrings

**担当**: 開発者  
**所要時間**: 45分  
**依存**: タスク 3.1, 3.3, 3.5

---

### タスク 4.2: analyzer のテスト作成
- [ ] `tests/test_analyzer.py` の作成
- [ ] 統合テスト（全体フロー）
- [ ] モックを使用した単体テスト
- [ ] エラーハンドリングのテスト

**担当**: 開発者  
**所要時間**: 45分  
**依存**: タスク 4.1

---

### タスク 4.3: main.py の実装
- [ ] コマンドライン引数の定義
  - 入力ファイルパス（必須）
  - 出力ファイルパス（オプション、デフォルト: report.html）
- [ ] `main()` 関数の実装
  - 引数パース
  - analyzer.analyze_csv() 呼び出し
  - reporter.generate_html_report() 呼び出し
  - reporter.print_summary() 呼び出し
  - エラーハンドリング
- [ ] エントリポイント設定（`if __name__ == "__main__"`）
- [ ] 型ヒントと docstrings

**担当**: 開発者  
**所要時間**: 30分  
**依存**: タスク 4.1, 3.7

---

### タスク 4.4: CLI のテスト作成
- [ ] `tests/test_main.py` の作成
- [ ] コマンドライン引数のテスト
- [ ] エンドツーエンドテスト
- [ ] エラーハンドリングのテスト

**担当**: 開発者  
**所要時間**: 30分  
**依存**: タスク 4.3

---

## フェーズ5: サンプルデータと最終調整

### タスク 5.1: サンプルデータの作成
- [ ] `data/sample_data.csv` の作成
  - 適切なサイズ（20-50行程度）
  - 有効なデータ
  - 統計的に意味のある分布

**担当**: 開発者  
**所要時間**: 15分  
**依存**: なし

---

### タスク 5.2: 依存関係のインストールと動作確認
- [ ] `uv venv` で仮想環境作成
- [ ] `uv pip install -e ".[dev]"` で依存関係インストール
- [ ] サンプルデータで動作確認
- [ ] 生成されたHTMLレポートの確認

**担当**: 開発者  
**所要時間**: 15分  
**依存**: タスク 1.2, 5.1

---

### タスク 5.3: コード品質チェック
- [ ] `ruff check .` でリントチェック
- [ ] `ruff format .` でフォーマット
- [ ] `mypy src/` で型チェック
- [ ] すべてのエラー・警告の修正

**担当**: 開発者  
**所要時間**: 30分  
**依存**: すべての実装タスク

---

### タスク 5.4: 全テストの実行
- [ ] `pytest` で全テストを実行
- [ ] カバレッジレポートの確認（オプション）
- [ ] すべてのテストがパスすることを確認

**担当**: 開発者  
**所要時間**: 15分  
**依存**: すべてのテストタスク

---

### タスク 5.5: ドキュメントの最終確認
- [ ] README.md の内容確認
- [ ] インストール手順の動作確認
- [ ] 使用例の動作確認
- [ ] 必要に応じて修正

**担当**: 開発者  
**所要時間**: 15分  
**依存**: タスク 5.2

---

## タスクサマリー

| フェーズ | タスク数 | 合計所要時間（目安） |
|---------|---------|-------------------|
| フェーズ1: プロジェクトセットアップ | 3 | 45分 |
| フェーズ2: データモデルの実装 | 2 | 60分 |
| フェーズ3: サービスレイヤーの実装 | 8 | 5時間15分 |
| フェーズ4: アプリケーションレイヤーの実装 | 4 | 2時間30分 |
| フェーズ5: サンプルデータと最終調整 | 5 | 1時間30分 |
| **合計** | **22** | **約10時間** |

## 推奨実装順序

1. **フェーズ1**: プロジェクト基盤の構築
2. **フェーズ2**: データモデルの実装（他のすべてが依存）
3. **フェーズ3**: サービスレイヤーを順次実装（各サービスは独立）
   - 並行作業可能: data_loader、statistics、visualizer、reporter
4. **フェーズ4**: アプリケーションレイヤーで統合
5. **フェーズ5**: 動作確認と品質保証

## 成功基準

- [ ] すべてのテストがパス
- [ ] ruff チェックでエラーなし
- [ ] mypy チェックでエラーなし
- [ ] サンプルデータで正しくレポート生成
- [ ] HTMLレポートが読みやすく表示される
- [ ] README の手順で正常にセットアップ可能
